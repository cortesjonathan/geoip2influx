[agent]
  interval = "10s"
  flush_interval = "10s"

[[inputs.tail]]
  files = ["/logs/traefik-access.json"]
  from_beginning = false
  data_format = "json"

  # Campos típicos Traefik JSON v2/v3 (ajusta si difiere)
  json_string_fields = ["ClientAddr","RequestHost","RequestMethod","RequestPath","ServiceName","RouterName"]
  json_time_key = "StartUTC"           # si no está, comenta estas 2 líneas
  json_time_format = "2006-01-02T15:04:05Z07:00"

# Extrae IP (quita el :puerto)
[[processors.regex]]
  [[processors.regex.fields]]
    key = "ClientAddr"
    pattern = "^(?P<ip>[^:]+)"
    replacement = "${ip}"
    result_key = "remote_addr"

# GeoIP
[[processors.geoip]]
  source = "remote_addr"
  database = "/geoip/GeoLite2-City.mmdb"

[[outputs.influxdb_v2]]
  urls     = ["$INFLUX_URL"]
  token    = "$INFLUX_TOKEN"
  organization = "$INFLUX_ORG"
  bucket   = "$INFLUX_BUCKET"